{% extends "admin/dashboard/base_admin.html" %}

{% load i18n humanize %}

{% block page_title %}
  {% trans "User Management" %}
{% endblock page_title %}
{% block page_description %}
  {% trans "User analytics and management tools" %}
{% endblock page_description %}
{% block admin_content %}
  <!-- User Metrics -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    <div class="admin-metric-card">
      <div class="admin-metric-value">{{ total_users|intcomma }}</div>
      <div class="admin-metric-label">{% trans "Total Users" %}</div>
    </div>
    <div class="admin-metric-card">
      <div class="admin-metric-value">{{ active_users_24h|intcomma }}</div>
      <div class="admin-metric-label">{% trans "Active (24h)" %}</div>
    </div>
    <div class="admin-metric-card">
      <div class="admin-metric-value">{{ new_users_7d|intcomma }}</div>
      <div class="admin-metric-label">{% trans "New (7d)" %}</div>
    </div>
    <div class="admin-metric-card">
      <div class="admin-metric-value">{{ new_users_30d|intcomma }}</div>
      <div class="admin-metric-label">{% trans "New (30d)" %}</div>
    </div>
  </div>
  <!-- User List -->
  <div class="admin-chart-container">
    <h3 class="admin-chart-title">{% trans "Recent Users" %}</h3>
    <div class="overflow-x-auto">
      <table class="admin-table">
        <thead>
          <tr>
            <th>{% trans "User" %}</th>
            <th>{% trans "Joined" %}</th>
            <th>{% trans "Last Login" %}</th>
            <th>{% trans "Status" %}</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
            <tr>
              <td>
                <div class="text-sm font-medium text-gray-900 dark:text-white">{{ user.email }}</div>
                <div class="text-sm text-gray-500 dark:text-slate-400">{{ user.name|default:"No name" }}</div>
              </td>
              <td>
                <span class="admin-badge secondary">{{ user.date_joined|date:"M j, Y" }}</span>
              </td>
              <td>
                <span class="admin-badge info">{{ user.last_login|date:"M j, Y"|default:"Never" }}</span>
              </td>
              <td>
                {% if user.is_active %}
                  <span class="admin-badge success">{% trans "Active" %}</span>
                {% else %}
                  <span class="admin-badge danger">{% trans "Inactive" %}</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <!-- Pagination -->
    {% if users.has_other_pages %}
      <div class="border-t border-gray-200 dark:border-slate-700 px-4 py-3 flex items-center justify-between sm:px-6">
        <div class="flex-1 flex justify-between sm:hidden">
          {% if users.has_previous %}
            <a href="?page={{ users.previous_page_number }}"
               class="admin-btn admin-btn-secondary">{% trans "Previous" %}</a>
          {% endif %}
          {% if users.has_next %}
            <a href="?page={{ users.next_page_number }}"
               class="admin-btn admin-btn-secondary">{% trans "Next" %}</a>
          {% endif %}
        </div>
        <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
          <div>
            <p class="text-sm text-gray-700 dark:text-slate-300">
              {% trans "Showing" %}
              <span class="font-medium">{{ users.start_index }}</span>
              {% trans "to" %}
              <span class="font-medium">{{ users.end_index }}</span>
              {% trans "of" %}
              <span class="font-medium">{{ users.paginator.count }}</span>
              {% trans "results" %}
            </p>
          </div>
          <div>
            <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px">
              {% if users.has_previous %}
                <a href="?page={{ users.previous_page_number }}"
                   class="admin-btn admin-btn-secondary">{% trans "Previous" %}</a>
              {% endif %}
              {% if users.has_next %}
                <a href="?page={{ users.next_page_number }}"
                   class="admin-btn admin-btn-secondary">{% trans "Next" %}</a>
              {% endif %}
            </nav>
          </div>
        </div>
      </div>
    {% endif %}
  </div>
{% endblock admin_content %}
