{% extends "news/base_news.html" %}

{% load i18n humanize %}

{% block news_title %}
  For You - Personalized News
{% endblock news_title %}
{% block news_content %}
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    {% if show_login_prompt %}
      <!-- Login Prompt for Anonymous Users -->
      <div class="max-w-4xl mx-auto text-center py-16">
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg p-8 md:p-12">
          <div class="mx-auto h-20 w-20 flex items-center justify-center rounded-full bg-primary-100 dark:bg-primary-900/20 mb-8">
            <svg class="h-10 w-10 text-primary-600 dark:text-primary-400"
                 fill="none"
                 stroke="currentColor"
                 viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z">
              </path>
            </svg>
          </div>
          <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-6">Get Your Personalized News Feed</h1>
          <p class="text-xl text-gray-600 dark:text-slate-400 mb-8 max-w-2xl mx-auto">
            Sign in to unlock AI-powered recommendations tailored to your interests.
            Discover articles that matter to you from 100+ trusted sources.
          </p>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <div class="text-center">
              <div class="mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-blue-100 dark:bg-blue-900/20 mb-4">
                <svg class="h-6 w-6 text-blue-600 dark:text-blue-400"
                     fill="none"
                     stroke="currentColor"
                     viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z">
                  </path>
                </svg>
              </div>
              <h3 class="font-semibold text-gray-900 dark:text-white mb-2">Smart Recommendations</h3>
              <p class="text-sm text-gray-600 dark:text-slate-400">AI learns your reading habits to suggest relevant articles</p>
            </div>
            <div class="text-center">
              <div class="mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-green-100 dark:bg-green-900/20 mb-4">
                <svg class="h-6 w-6 text-green-600 dark:text-green-400"
                     fill="none"
                     stroke="currentColor"
                     viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
                  </path>
                </svg>
              </div>
              <h3 class="font-semibold text-gray-900 dark:text-white mb-2">Curated Content</h3>
              <p class="text-sm text-gray-600 dark:text-slate-400">
                Choose your favorite topics and sources for personalized feeds
              </p>
            </div>
            <div class="text-center">
              <div class="mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-purple-100 dark:bg-purple-900/20 mb-4">
                <svg class="h-6 w-6 text-purple-600 dark:text-purple-400"
                     fill="none"
                     stroke="currentColor"
                     viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                </svg>
              </div>
              <h3 class="font-semibold text-gray-900 dark:text-white mb-2">Real-time Updates</h3>
              <p class="text-sm text-gray-600 dark:text-slate-400">Stay updated with breaking news and trending stories</p>
            </div>
          </div>
          <div class="space-y-3 sm:space-y-0 sm:space-x-3 sm:flex sm:justify-center">
            <a href="{% url 'account_signup' %}"
               class="btn btn-primary btn-lg w-full sm:w-auto">
              Get Started Free
              <svg class="ml-2 h-4 w-4"
                   fill="none"
                   stroke="currentColor"
                   viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
              </svg>
            </a>
            <a href="{% url 'account_login' %}"
               class="btn btn-secondary btn-lg w-full sm:w-auto">Sign In</a>
          </div>
        </div>
        <!-- Sample trending articles for anonymous users -->
        {% if trending_articles %}
          <div class="mt-16">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-8">Trending News Right Now</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {% for article in trending_articles %}
                {% include 'news/partials/news_card_secondary.html' %}
              {% endfor %}
            </div>
          </div>
        {% endif %}
      </div>
    {% else %}
      <!-- Authenticated User Content -->
      {% if show_onboarding %}
        <!-- Force Onboarding - No Content Until Complete -->
        <div class="max-w-4xl mx-auto text-center py-16">
          <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg p-8 md:p-12">
            <div class="mx-auto h-20 w-20 flex items-center justify-center rounded-full bg-primary-100 dark:bg-primary-900/20 mb-8">
              <svg class="h-10 w-10 text-primary-600 dark:text-primary-400"
                   fill="none"
                   stroke="currentColor"
                   viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
                </path>
              </svg>
            </div>
            <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-6">Let's Personalize Your News Feed</h1>
            <p class="text-xl text-gray-600 dark:text-slate-400 mb-8 max-w-2xl mx-auto">
              To get started with your personalized news experience, please tell us about your interests and preferred sources.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
              <div class="text-center">
                <div class="mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-blue-100 dark:bg-blue-900/20 mb-4">
                  <svg class="h-6 w-6 text-blue-600 dark:text-blue-400"
                       fill="none"
                       stroke="currentColor"
                       viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z">
                    </path>
                  </svg>
                </div>
                <h3 class="font-semibold text-gray-900 dark:text-white mb-2">Choose Your Topics</h3>
                <p class="text-sm text-gray-600 dark:text-slate-400">Select categories that interest you most</p>
              </div>
              <div class="text-center">
                <div class="mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-green-100 dark:bg-green-900/20 mb-4">
                  <svg class="h-6 w-6 text-green-600 dark:text-green-400"
                       fill="none"
                       stroke="currentColor"
                       viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z">
                    </path>
                  </svg>
                </div>
                <h3 class="font-semibold text-gray-900 dark:text-white mb-2">Pick Your Sources</h3>
                <p class="text-sm text-gray-600 dark:text-slate-400">Choose trusted news sources you prefer</p>
              </div>
            </div>
            <div class="space-y-4">
              <button onclick="showOnboardingModal()" class="btn btn-primary btn-lg">
                Set Up My Preferences
                <svg class="ml-2 h-4 w-4"
                     fill="none"
                     stroke="currentColor"
                     viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                </svg>
              </button>
              <div class="text-sm text-gray-600 dark:text-slate-400">
                or <a href="{% url 'news:preferences' %}"
    class="text-primary-600 dark:text-primary-400 hover:underline">go to preferences page</a>
              </div>
            </div>
          </div>
        </div>
      {% else %}
        <!-- Normal Authenticated User Content -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
          <!-- Main Content (3 columns) -->
          <div class="lg:col-span-3">
            <!-- Active Filters Display -->
            {% if request.GET.category or request.GET.source or request.GET.sentiment or request.GET.sort %}
              <div class="mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg">
                <div class="flex items-center justify-between">
                  <div class="flex items-center space-x-2">
                    <svg class="w-5 h-5 text-blue-600 dark:text-blue-400"
                         fill="none"
                         stroke="currentColor"
                         viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.707A1 1 0 013 7V4z">
                      </path>
                    </svg>
                    <span class="text-sm font-medium text-blue-800 dark:text-blue-200">{% trans "Active Filters:" %}</span>
                    <div class="flex items-center space-x-2">
                      {% if request.GET.category %}
                        <span class="px-2 py-1 bg-blue-100 dark:bg-blue-800 text-blue-800 dark:text-blue-200 text-xs rounded-full">
                          {% trans "Category:" %} {{ request.GET.category|capfirst }}
                        </span>
                      {% endif %}
                      {% if request.GET.source %}
                        <span class="px-2 py-1 bg-blue-100 dark:bg-blue-800 text-blue-800 dark:text-blue-200 text-xs rounded-full">
                          {% trans "Source ID:" %} {{ request.GET.source }}
                        </span>
                      {% endif %}
                      {% if request.GET.sentiment %}
                        <span class="px-2 py-1 bg-blue-100 dark:bg-blue-800 text-blue-800 dark:text-blue-200 text-xs rounded-full">
                          {% if request.GET.sentiment == 'positive' %}
                            üòä {% trans "Positive" %}
                          {% elif request.GET.sentiment == 'negative' %}
                            üòû {% trans "Negative" %}
                          {% else %}
                            üòê {% trans "Neutral" %}
                          {% endif %}
                        </span>
                      {% endif %}
                      {% if request.GET.sort %}
                        <span class="px-2 py-1 bg-blue-100 dark:bg-blue-800 text-blue-800 dark:text-blue-200 text-xs rounded-full">
                          {% trans "Sort:" %}
                          {% if request.GET.sort == 'relevance' %}
                            {% trans "Relevance" %}
                          {% elif request.GET.sort == 'latest' %}
                            {% trans "Latest" %}
                          {% elif request.GET.sort == 'popular' %}
                            {% trans "Popular" %}
                          {% else %}
                            {{ request.GET.sort|capfirst }}
                          {% endif %}
                        </span>
                      {% endif %}
                    </div>
                  </div>
                  <a href="{% url 'news:for-you' %}"
                     class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200 transition-colors">
                    {% trans "Clear All" %}
                  </a>
                </div>
              </div>
            {% endif %}
            <!-- Recommended Articles -->
            {% if recommended_articles %}
              <section class="mb-8">
                <div class="mb-6">
                  <h2 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center">
                    <span class="mr-2">‚≠ê</span>
                    {% trans "Recommended for You" %}
                  </h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  {% for article in recommended_articles|slice:":6" %}
                    {% include 'news/partials/news_card_secondary.html' %}
                  {% endfor %}
                </div>
                <!-- HTMX Infinite Scroll Container -->
                <div id="articles-container"
                     class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                  <!-- Additional recommended articles will be loaded here -->
                </div>
                <!-- HTMX Load More Trigger -->
                <div class="text-center pt-8"
                     hx-get="{% url 'news:load-more' %}?page=2&type=for-you{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.sentiment %}&sentiment={{ request.GET.sentiment }}{% endif %}{% if request.GET.source %}&source={{ request.GET.source }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}"
                     hx-target="#articles-container"
                     hx-swap="beforeend"
                     hx-trigger="revealed"
                     hx-indicator="#loading-indicator">
                  <div class="flex items-center justify-center">
                    <div class="spinner w-6 h-6 mr-3"></div>
                    <span class="text-gray-600 dark:text-slate-400">{% trans "Loading more recommendations..." %}</span>
                  </div>
                </div>
              </section>
            {% else %}
              <!-- No Recommendations Available -->
              <div class="text-center py-16">
                <div class="mx-auto h-16 w-16 flex items-center justify-center rounded-full bg-gray-100 dark:bg-slate-700 mb-6">
                  <svg class="h-8 w-8 text-gray-400 dark:text-slate-500"
                       fill="none"
                       stroke="currentColor"
                       viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z">
                    </path>
                  </svg>
                </div>
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">{% trans "Start Building Your Feed" %}</h3>
                <p class="text-gray-600 dark:text-slate-400 mb-6">
                  {% trans "Read some articles and bookmark content you like to get personalized recommendations!" %}
                </p>
                <a href="{% url 'news:home' %}" class="btn btn-primary">
                  <svg class="w-4 h-4 mr-2"
                       fill="none"
                       stroke="currentColor"
                       viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z">
                    </path>
                  </svg>
                  {% trans "Explore Latest News" %}
                </a>
              </div>
            {% endif %}
          </div>
          <!-- Sidebar (1 column) -->
          <div class="lg:col-span-1 space-y-6">
            <div class="sticky top-24 space-y-6">
              <!-- Filters -->
              {% include 'news/partials/filter_sidebar.html' with page_type="for-you" show_sort=True show_category_filter=True show_source_filter=True show_sentiment=True filter_categories=filter_categories filter_sources=filter_sources %}
              <!-- Recent Activity -->
              {% if recent_activity %}
                <div class="bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-gray-200 dark:border-slate-700 p-6">
                  <h3 class="font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                    <svg class="w-5 h-5 mr-2 text-primary-600"
                         fill="none"
                         stroke="currentColor"
                         viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z">
                      </path>
                    </svg>
                    Recent Activity
                  </h3>
                  <div class="space-y-3">
                    {% for interaction in recent_activity %}
                      <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0">
                          {% if interaction.action == 'bookmark' %}
                            <div class="w-2 h-2 bg-yellow-500 rounded-full mt-2"></div>
                          {% else %}
                            <div class="w-2 h-2 bg-blue-500 rounded-full mt-2"></div>
                          {% endif %}
                        </div>
                        <div class="flex-1 min-w-0">
                          <p class="text-sm text-gray-900 dark:text-white line-clamp-2">{{ interaction.article.title }}</p>
                          <p class="text-xs text-gray-500 dark:text-slate-400 mt-1">
                            {{ interaction.action|capfirst }} ‚Ä¢ {{ interaction.created|timesince }} ago
                          </p>
                        </div>
                      </div>
                    {% endfor %}
                  </div>
                </div>
              {% endif %}
              <!-- Bookmarked Articles -->
              {% if bookmarked_articles %}
                <div class="bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-gray-200 dark:border-slate-700 p-6">
                  <h3 class="font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                    <svg class="w-5 h-5 mr-2 text-yellow-600"
                         fill="none"
                         stroke="currentColor"
                         viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z">
                      </path>
                    </svg>
                    Saved Articles
                  </h3>
                  <div class="space-y-3">
                    {% for article in bookmarked_articles %}
                      <div>
                        <h4 class="text-sm font-medium text-gray-900 dark:text-white line-clamp-2 hover:text-primary-600 dark:hover:text-primary-400">
                          <a href="{{ article.url }}" target="_blank" rel="noopener noreferrer">{{ article.title }}</a>
                        </h4>
                        <p class="text-xs text-gray-500 dark:text-slate-400 mt-1">
                          {{ article.source.name }} ‚Ä¢ {{ article.published_at|timesince }} ago
                        </p>
                      </div>
                    {% endfor %}
                  </div>
                </div>
              {% endif %}
              <!-- Quick Actions -->
              <div class="bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-gray-200 dark:border-slate-700 p-6">
                <h3 class="font-bold text-gray-900 dark:text-white mb-4">Quick Actions</h3>
                <div class="space-y-3">
                  <a href="#"
                     onclick="focusSearchBar(event)"
                     class="flex items-center text-sm text-gray-700 dark:text-slate-300 hover:text-primary-600 dark:hover:text-primary-400">
                    <svg class="w-4 h-4 mr-2"
                         fill="none"
                         stroke="currentColor"
                         viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z">
                      </path>
                    </svg>
                    Search News
                  </a>
                  <a href="{% url 'news:trending' %}"
                     class="flex items-center text-sm text-gray-700 dark:text-slate-300 hover:text-primary-600 dark:hover:text-primary-400">
                    <svg class="w-4 h-4 mr-2"
                         fill="none"
                         stroke="currentColor"
                         viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                    </svg>
                    Trending Now
                  </a>
                  <a href="{% url 'news:preferences' %}"
                     class="flex items-center text-sm text-gray-700 dark:text-slate-300 hover:text-primary-600 dark:hover:text-primary-400">
                    <svg class="w-4 h-4 mr-2"
                         fill="none"
                         stroke="currentColor"
                         viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                      </path>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    Customize Preferences
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      {% endif %}
    {% endif %}
  </div>
  <!-- Infinite Scroll Loading Indicator -->
  <div id="loading-indicator" class="hidden text-center py-8">
    <div class="inline-flex items-center">
      <div class="spinner w-6 h-6 mr-3"></div>
      <span class="text-gray-600 dark:text-slate-400">{% trans "Loading more articles..." %}</span>
    </div>
  </div>
{% endblock news_content %}
{% block mobile_sidebar %}
  {% with show_mobile_filters=True page_type="for-you" show_sort=True show_category_filter=True show_source_filter=True show_sentiment=True filter_categories=filter_categories filter_sources=filter_sources %}
    {% include 'news/partials/mobile_sidebar_sheet.html' %}
  {% endwith %}
{% endblock mobile_sidebar %}
{% block modal %}
  {% if show_onboarding %}
    {% include 'news/partials/onboarding_modal.html' %}
    <!-- Auto-show modal for users who need onboarding -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        {
          %
          if show_onboarding %
        }
        showOnboardingModal();
        {
          %
          endif %
        }
      });
    </script>
  {% endif %}
{% endblock modal %}
{% block inline_javascript %}
  <!-- Focus search bar function - available for all users -->
  <script>
    function focusSearchBar(event) {
      event.preventDefault();

      // Try multiple selectors to find the search input
      const searchSelectors = [
        'input[name="q"]',
        'input[type="search"]',
        'input[placeholder*="Search"]',
        '.form-input[placeholder*="Search"]',
        '#search-input',
        '.search-input',
        'nav input[type="search"]',
        'form input[name="q"]'
      ];

      let searchInput = null;
      for (const selector of searchSelectors) {
        searchInput = document.querySelector(selector);
        if (searchInput) {
          break;
        }
      }

      if (searchInput) {
        // Scroll to search bar first to make it visible
        searchInput.scrollIntoView({
          behavior: 'smooth',
          block: 'center'
        });

        // Small delay to ensure scrolling completes before focusing
        setTimeout(() => {
          // Focus and select all text
          searchInput.focus();
          searchInput.select();

          // Add a visual highlight effect
          searchInput.style.boxShadow = '0 0 0 3px rgba(73, 148, 232, 0.3)';
          searchInput.style.borderColor = '#4994e8';

          // Remove highlight after 2 seconds
          setTimeout(() => {
            searchInput.style.boxShadow = '';
            searchInput.style.borderColor = '';
          }, 2000);
        }, 300);
      } else {
        // Fallback: scroll to top where search bar is
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      }
    }
  </script>
{% endblock inline_javascript %}
