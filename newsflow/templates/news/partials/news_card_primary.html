{% load i18n humanize news_tags %}

<!-- Primary News Card (Large Featured) -->
<article class="news-card group relative overflow-hidden bg-white dark:bg-slate-800 rounded-xl shadow-soft hover:shadow-lg transition-all duration-300 border border-gray-200 dark:border-slate-700 hover:border-primary-200 dark:hover:border-primary-700">
  <!-- Featured Badge -->
  {% if article.is_featured %}
    <div class="absolute top-4 left-4 z-10">
      <span class="badge bg-yellow-500 text-white font-medium">‚≠ê {% trans "Featured" %}</span>
    </div>
  {% endif %}
  <!-- Article Link -->
  <a href="{{ article.url }}"
     target="_blank"
     rel="noopener noreferrer"
     class="block"
     onclick="trackArticleClick({{ article.id }})">
    <!-- Image Container -->
    <div class="relative aspect-video overflow-hidden">
      {% if article.top_image %}
        <img src="{{ article.top_image }}"
             alt="{{ article.title }}"
             class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
             loading="lazy" />
      {% else %}
        <div class="w-full h-full bg-gradient-to-br from-primary-100 to-primary-200 dark:from-slate-700 dark:to-slate-600 flex items-center justify-center">
          <svg class="w-16 h-16 text-primary-300 dark:text-slate-500"
               fill="none"
               stroke="currentColor"
               viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z">
            </path>
          </svg>
        </div>
      {% endif %}
      <!-- Overlays -->
      <div class="absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent"></div>
      <!-- Sentiment Badge -->
      {% if article.sentiment_label %}
        <div class="absolute top-4 right-4">
          <span class="badge text-xs {% if article.sentiment_label == 'positive' %}bg-green-500 text-white{% elif article.sentiment_label == 'negative' %}bg-red-500 text-white{% else %}bg-gray-500 text-white{% endif %}">
            {% if article.sentiment_label == 'positive' %}
              üòä
            {% elif article.sentiment_label == 'negative' %}
              üòû
            {% else %}
              üòê
            {% endif %}
            {{ article.sentiment_label|capfirst }}
          </span>
        </div>
      {% endif %}
      <!-- Reading Time -->
      <div class="absolute bottom-4 left-4">
        <span class="bg-black/70 text-white px-2 py-1 rounded text-xs font-medium">üìñ {{ article.read_time }}min read</span>
      </div>
      <!-- View Count -->
      <div class="absolute bottom-4 right-4">
        <span class="bg-black/70 text-white px-2 py-1 rounded text-xs font-medium">üëÅ {{ article.view_count|intcomma }}</span>
      </div>
    </div>
  </a>
  <!-- Content -->
  <div class="p-6">
    <!-- Categories -->
    {% if article.categories.all %}
      <div class="flex flex-wrap gap-2 mb-3">
        {% for category in article.categories.all|slice:":3" %}
          <span class="badge badge-primary text-xs">{{ category.name }}</span>
        {% endfor %}
        {% if article.categories.count > 3 %}
          <span class="text-xs text-gray-500 dark:text-slate-400">+{{ article.categories.count|add:"-3" }} more</span>
        {% endif %}
      </div>
    {% endif %}
    <!-- Title -->
    <a href="{{ article.url }}"
       target="_blank"
       rel="noopener noreferrer"
       onclick="trackArticleClick({{ article.id }})">
      <h2 class="text-xl font-bold text-gray-900 dark:text-white group-hover:text-primary-700 dark:group-hover:text-primary-400 transition-colors duration-200 leading-tight mb-3">
        {{ article.title }}
      </h2>
    </a>
    <!-- Summary -->
    {% if article.summary %}
      <div class="mb-4">
        <div class="flex items-start justify-between mb-2">
          <div class="flex items-center space-x-2">
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-primary-100 text-primary-800 dark:bg-primary-900 dark:text-primary-300">
              <svg class="w-3 h-3 mr-1"
                   fill="none"
                   stroke="currentColor"
                   viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z">
                </path>
              </svg>
              {% trans "AI Summary" %}
            </span>
          </div>
          <!-- Mobile Summary Button -->
          <button class="summary-modal-btn md:hidden inline-flex items-center px-3 py-1.5 text-xs font-medium text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/20 rounded-lg hover:bg-primary-100 dark:hover:bg-primary-900/40 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500"
                  data-article-id="{{ article.id }}"
                  data-title="{{ article.title|escapejs }}"
                  data-summary="{{ article.summary|escapejs }}"
                  data-keywords="{% if article.keywords %}{{ article.keywords|join:',' }}{% endif %}"
                  data-url="{{ article.url }}"
                  data-bookmarked="{% is_bookmarked article user %}">
            <svg class="w-3 h-3 mr-1"
                 fill="none"
                 stroke="currentColor"
                 viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
              </path>
            </svg>
            {% trans "View Summary" %}
          </button>
        </div>
        <div class="summary-content">
          <p class="text-gray-600 dark:text-slate-400 leading-relaxed">
            <!-- Desktop: Show full summary -->
            <span class="hidden md:block">{{ article.summary }}</span>
            <!-- Mobile: Show truncated with toggle -->
            <span class="md:hidden">
              <span class="summary-short">{{ article.summary|truncatewords:30 }}</span>
              <span class="summary-full hidden">{{ article.summary }}</span>
              {% if article.summary|wordcount > 30 %}
                <button class="summary-toggle text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 text-sm font-medium ml-1 focus:outline-none transition-colors"
                        aria-expanded="false">{% trans "Read more" %}</button>
              {% endif %}
            </span>
          </p>
        </div>
      </div>
    {% elif article.content %}
      <div class="mb-4">
        <div class="summary-content">
          <p class="text-gray-600 dark:text-slate-400 leading-relaxed">
            <!-- Desktop: Show full content -->
            <span class="hidden md:block">{{ article.content }}</span>
            <!-- Mobile: Show truncated with toggle -->
            <span class="md:hidden">
              <span class="summary-short">{{ article.content|truncatewords:30 }}</span>
              <span class="summary-full hidden">{{ article.content }}</span>
              {% if article.content|wordcount > 30 %}
                <button class="summary-toggle text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 text-sm font-medium ml-1 focus:outline-none transition-colors"
                        aria-expanded="false">{% trans "Read more" %}</button>
              {% endif %}
            </span>
          </p>
        </div>
      </div>
    {% endif %}
    <!-- Keywords -->
    {% if article.keywords %}
      <div class="flex flex-wrap gap-1 mb-4">
        {% for keyword in article.keywords|slice:":5" %}
          <span class="text-xs bg-gray-100 dark:bg-slate-700 text-gray-600 dark:text-slate-300 px-2 py-1 rounded">
            #{{ keyword }}
          </span>
        {% endfor %}
      </div>
    {% endif %}
    <!-- Meta Information -->
    <div class="flex items-center justify-between text-sm text-gray-500 dark:text-slate-400">
      <div class="flex items-center space-x-3">
        <!-- Source -->
        <div class="flex items-center space-x-1">
          <span class="font-medium text-gray-700 dark:text-slate-300">{{ article.source.name }}</span>
          <!-- Credibility Score -->
          <div class="flex items-center ml-1">
            {% for i in "12345"|make_list %}
              <svg class="w-3 h-3 {% if article.source.credibility_score >= i|add:0 %}text-yellow-400{% else %}text-gray-300 dark:text-slate-600{% endif %}"
                   fill="currentColor"
                   viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
            {% endfor %}
            <span class="text-xs ml-1">{{ article.source.credibility_score }}/10</span>
          </div>
          <!-- Bias Rating -->
          <span class="text-xs badge {% if article.source.bias_rating == 'center' %}bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300{% elif article.source.bias_rating == 'left' %}bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300{% else %}bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300{% endif %}">
            {{ article.source.get_bias_rating_display }}
          </span>
        </div>
      </div>
      <div class="flex items-center space-x-3">
        <!-- Author -->
        {% if article.author %}<span class="text-xs">by {{ article.author|truncatewords:2 }}</span>{% endif %}
        <!-- Time -->
        <span class="text-xs" title="{{ article.published_at }}">{{ article.published_at|timesince }} ago</span>
      </div>
    </div>
  </div>
  <!-- Action Buttons (Visible on Hover) -->
  <div class="absolute top-4 left-4 opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10 flex space-x-2">
    {% is_bookmarked article user as is_bookmarked %}
    <button class="btn btn-sm bg-white/90 dark:bg-slate-800/90 shadow-lg hover:bg-white dark:hover:bg-slate-800 bookmark-btn {% if is_bookmarked %}text-yellow-500{% else %}text-gray-400 hover:text-yellow-500{% endif %} transition-colors"
            data-article-id="{{ article.id }}"
            data-article-title="{{ article.title|escapejs }}"
            data-article-url="{{ article.url }}"
            data-bookmarked="{% if is_bookmarked %}true{% else %}false{% endif %}"
            title="{% if is_bookmarked %}{% trans 'Remove bookmark' %}{% else %}{% trans 'Bookmark' %}{% endif %}">
      <svg class="w-4 h-4"
           {% if is_bookmarked %}fill="currentColor"{% else %}fill="none"{% endif %}
           stroke="currentColor"
           viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z">
        </path>
      </svg>
    </button>
    <button class="btn btn-sm bg-white/90 dark:bg-slate-800/90 shadow-lg hover:bg-white dark:hover:bg-slate-800 share-btn text-gray-400 hover:text-blue-500 transition-colors"
            data-url="{{ article.url }}"
            data-title="{{ article.title|escapejs }}"
            title="{% trans 'Share' %}">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z">
        </path>
      </svg>
    </button>
  </div>
</article>
